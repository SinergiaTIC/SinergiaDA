<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <!-- Botón para crear un nuevo informe -->
  <div *ngIf="!isObserver">
    <button type="button" class="btn btn-dark" (click)="initDialog()">
      <i class="fa fa-plus-circle mr-2 fa-lg"></i>
      <span i18n="@@tituloNuevoInforme">Nuevo informe</span>
    </button>
  </div>

  <!-- Barra de Tags -->
  <div class="ml-3">
    <div class="dropdown">
      <button
        class="btn btn-secondary dropdown-toggle"
        type="button"
        id="dropdownMenuButton"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Etiqueta:
        {{
          selectedTags.length > 0
            ? selectedTags.length + " seleccionados"
            : "Todos"
        }}
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <div class="px-3 py-2">
          <input
            type="text"
            class="form-control"
            placeholder="Buscar tipo"
            [(ngModel)]="tagSearchTerm"
            (input)="filterTags()"
          />
        </div>
        <div class="dropdown-divider"></div>
        <div *ngFor="let tag of filteredTags" class="dropdown-item">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="'tag-' + tag.value"
              [checked]="selectedTags.includes(tag)"
              (change)="toggleTagSelection(tag)"
            />
            <label class="form-check-label" [for]="'tag-' + tag.value">
              {{ tag.label }}
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Nuevo Filtro de Grupos -->
  <div class="ml-auto ml-3">
    <div class="dropdown">
      <button
        class="btn btn-secondary dropdown-toggle"
        type="button"
        id="dropdownGroupButton"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Grupo:
        {{
          selectedGroups.length > 0
            ? selectedGroups.length + " seleccionados"
            : "Todos"
        }}
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownGroupButton">
        <div class="px-3 py-2">
          <input
            type="text"
            class="form-control"
            placeholder="Buscar grupo"
            [(ngModel)]="groupSearchTerm"
            (input)="filterGroups()"
          />
        </div>
        <div class="dropdown-divider"></div>
        <div *ngFor="let group of filteredGroups" class="dropdown-item">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="'group-' + group.value"
              [checked]="selectedGroups.includes(group)"
              (change)="toggleGroupSelection(group)"
            />
            <label class="form-check-label" [for]="'group-' + group.value">
              {{ group.label }}
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="ml-auto ml-3">
    <div class="btn-group" role="group" aria-label="Filtrar por tipo">
      <button
        *ngFor="let typeObj of dashboardTypes"
        type="button"
        class="btn btn-outline-light"
        title="{{ typeObj.label }}"
        [class.active]="typeObj.active"
        (click)="toggleTypeSelection(typeObj.type)"
        [style.color]="typeObj.color"
      >
        <i class="fa {{ typeObj.icon }} mr-1"></i>
      </button>
    </div>
  </div>

  <!-- Botones para cambiar el modo de visualización -->
  <div class="ml-auto mr-3">
    <div class="btn-group" role="group" aria-label="Modo de visualización">
      <button
        type="button"
        class="btn btn-outline-light"
        [class.active]="viewMode === 'table'"
        (click)="setViewMode('table')"
        title="Vista de tabla"
      >
        <i class="fa fa-table"></i>
      </button>
      <button
        type="button"
        class="btn btn-outline-light"
        [class.active]="viewMode === 'card'"
        (click)="setViewMode('card')"
        title="Vista de fichas"
      >
        <i class="fa fa-th-large"></i>
      </button>
    </div>
  </div>

  <!-- <div *ngIf="tags.length !== 2" class="ml-3">
    <div class="navbar-text mr-2">Tags:</div>
    <div class="btn-group" role="group">
      <button
        type="button"
        class="btn btn-outline-light"
        *ngFor="let tag of tags"
        [class.active]="
          selectedTag === tag.value || (tag.value === null && selectedTag === 0)
        "
        (click)="filterDashboards(tag)"
      >
        {{ tag.label }}
      </button>
    </div>
  </div> -->

  <!-- Buscador -->
  <div class="ml-auto">
    <div class="search-container">
      <input
        type="text"
        class="form-control search-input"
        id="buscador"
        name="buscador"
        (keyup)="filterTitle($event)"
        i18n-placeholder="@@buscarPorNombre"
        placeholder="Buscar por nombre del informe"
      />
      <i class="fa fa-search search-icon"></i>
    </div>
  </div>
</nav>

<!-- Inicio de la tabla de Bootstrap -->
<div *ngIf="viewMode === 'table'" class="md-10">
  <table class="table table-striped" id="report-table">
    <thead>
      <tr>
        <th (click)="sortTable('config.title')">
          Nombre del Informe
          <i
            class="fa"
            [ngClass]="{
              'fa-sort-asc':
                sortColumn === 'config.title' && sortDirection === 'asc',
              'fa-sort-desc':
                sortColumn === 'config.title' && sortDirection === 'desc'
            }"
          ></i>
        </th>
        <th (click)="sortTable('type')">
          Tipo
          <i
            class="fa"
            [ngClass]="{
              'fa-sort-asc': sortColumn === 'type' && sortDirection === 'asc',
              'fa-sort-desc': sortColumn === 'type' && sortDirection === 'desc'
            }"
          ></i>
        </th>
        <th (click)="sortTable('user')">
          Autor
          <i
            class="fa"
            [ngClass]="{
              'fa-sort-asc': sortColumn === 'user' && sortDirection === 'asc',
              'fa-sort-desc': sortColumn === 'user' && sortDirection === 'desc'
            }"
          ></i>
        </th>
        <th>Fecha creación</th>
        <th>Edición privada</th>
        <th>Grupos</th>
        <th (click)="sortTable('config.tag')">
          Etiquetas
          <i
            class="fa"
            [ngClass]="{
              'fa-sort-asc':
                sortColumn === 'config.tag' && sortDirection === 'asc',
              'fa-sort-desc':
                sortColumn === 'config.tag' && sortDirection === 'desc'
            }"
          ></i>
        </th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let dashboard of visibleDashboards" >
        <td>
          <div class="title-container">
            {{ dashboard.config.title }}
            <div
              *ngIf="dashboard.config.description"
              class="info-icon-container"
            >
              <i class="fa fa-info-circle"></i>
              <div class="custom-tooltip">
                <p>{{ dashboard.config.description }}</p>
              </div>
            </div>
          </div>
        </td>
        <td>
          <span
            class="type-indicator"
            [style.background-color]="getDashboardTypeColor(dashboard.type)"
          ></span>
          {{ dashboard.type | titlecase }}
        </td>
        <td>{{ dashboard.user.name }}</td>
        <td></td>
        <td></td>
        <td>
          {{
            dashboard.group ? getGroupsNamesByDashboard([dashboard.group]) : ""
          }}
        </td>
        <td>
          <span class="badge badge-primary">{{ dashboard.config.tag }}</span>
        </td>
        <td>
          <span
            *ngIf="!isObserver && canIEdit(dashboard)"
            (click)="deleteDashboard(dashboard)"
            class="pointer"
          >
            <i class="fa fa-trash text-danger"></i>
          </span>
          <span
            *ngIf="!isObserver && canIEdit(dashboard)"
            (click)="cloneDashboard(dashboard)"
            class="pointer"
          >
            <i class="fa fa-clone text-info"></i>
          </span>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<!-- Fin de la tabla de Bootstrap -->

<div *ngIf="viewMode === 'card'" class="md-10">
  <div class="card-container">
    <div *ngFor="let dashboard of visibleDashboards" class="card-wrapper">
      <div
        class="card"
        [ngClass]="getDashboardTypeClass(dashboard.type)"
        (dblclick)="goToDashboard(dashboard)"
      >
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">
            <div class="title-container">
              {{ dashboard.config.title }}
              <div
                *ngIf="dashboard.config.description"
                class="info-icon-container"
              >
                <i class="fa fa-info-circle"></i>
                <div class="custom-tooltip">
                  <p>{{ dashboard.config.description }}</p>
                </div>
              </div>
            </div>
          </h5>
          <p class="card-text">
            <strong>Tipo:</strong> {{ dashboard.type | titlecase }}
          </p>
          <p class="card-text">
            <strong>Autor:</strong> {{ dashboard.user.name }}
          </p>
          <p class="card-text">
            <strong>Grupos:</strong>
            {{
              dashboard.group
                ? getGroupsNamesByDashboard([dashboard.group])
                : ""
            }}
          </p>
          <p class="card-text">
            <strong>Etiquetas:</strong>
            <span class="badge badge-primary">{{ dashboard.config.tag }}</span>
          </p>
          <div class="mt-auto">
            <button
              class="btn btn-primary btn-sm mr-2"
              (click)="goToDashboard(dashboard)"
            >
              Ver
            </button>
            <button
              *ngIf="!isObserver && canIEdit(dashboard)"
              class="btn btn-danger btn-sm mr-2"
              (click)="deleteDashboard(dashboard)"
            >
              <i class="fa fa-trash"></i>
            </button>
            <button
              *ngIf="!isObserver && canIEdit(dashboard)"
              class="btn btn-info btn-sm mr-2"
              (click)="cloneDashboard(dashboard)"
              title="Clonar informe"
            >
              <i class="fa fa-clone"></i>
            </button>
            <button
              *ngIf="dashboard.type == 'public'"
              class="btn btn-default btn-sm"
              publicUrl="/#/public/{{ dashboard._id }}"
              title="Copiar url pública "
              (click)="copyUrl(dashboard)"
            >
              <i class="fa fa-link"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-create-dashboard
  *ngIf="dashController"
  [controller]="dashController"
></app-create-dashboard>
