<div class="main-content" (window:resize)="onResize($event)" id='myDashboard'>
    <div class="ui-g-12" style="padding:2px">
        <eda-dashboard-panel class="pointer" (click)="setTitle()">
            <div class="d-flex justify-content-center">
                <h3 *ngIf="!titleClick" class="edaTitle"> {{title}} </h3>
                <input *ngIf="!!titleClick" (focusout)="setTitle()" (keydown.enter)="setTitle()" type="text"
                    class="w-100" [(ngModel)]="title" pInputText autofocusOnShow>
            </div>
        </eda-dashboard-panel>
    </div>

    <!-- ============================================================== -->
    <!-- GLOBAL FILTERS  -->
    <!-- ============================================================== -->
    <div class="ui-g-12" style="padding:4px;">
        <button class="filter-button" *ngIf="filtersList.length  > 0"
            (click)="reloadPanelsWithTimeOut()">
            <i class="pi pi-filter fiter-icon"></i> {{filtrar}}
        </button>
        <span *ngFor="let filter of filtersList">
            <span class="filter-name"  >
                {{filter.column.label}}:
            </span>
            <p-multiSelect *ngIf="filter.column.value.column_type !== 'date'" [options]="filter.data"
                [(ngModel)]="filter.selectedItems" [virtualScroll]="true" itemSize="30"
                defaultLabel="{{filter.column.label}}" class="global-filter-dropdown" maxSelectedLabels="1"
                (onPanelHide)="applyGlobalFilter(filter)">

                <p-footer>
                    <button type="submit" pButton (click)="removeGlobalFilter(filter)" icon="fa fa-trash"
                        class="ui-button-danger"></button>
                </p-footer>

            </p-multiSelect>
            <eda-date-picker *ngIf="filter.column.value.column_type === 'date'" [inject]="datePickerConfigs[filter.id]"
                (onDatesChanges)="processPickerEvent($event, filter)" (onRemove)="removeGlobalFilter(filter)" [autoRemove]="true"></eda-date-picker>
        </span>
    </div>


    <ngx-gridster class="dashboard-grid" [options]="gridsterOptions" [draggableOptions]="gridsterDraggableOptions"
        #gridster1>
        <!-- Normal Size -->
        <ng-container *ngIf="!toLitle && !toMedium">
            <ngx-gridster-item *ngFor="let panel of panels" [options]="itemOptions" [dragAndDrop]="true"
                [resizable]="panel.resizable" [(w)]="panel.w" [(h)]="panel.h" [(x)]="panel.x" [(y)]="panel.y"
                (change)="itemChange($event, panel)">

                <ng-container [ngSwitch]="panel.type">

                    <eda-blank-panel *ngSwitchCase="0" #edaPanel [panel]="panel" [inject]="inject"
                        (remove)="onRemovePanel($event)">
                    </eda-blank-panel>

                    <eda-title-panel *ngSwitchCase="1" #edaPanel [panel]="panel" [inject]="inject"
                        (remove)="onRemovePanel($event)">
                    </eda-title-panel>

                </ng-container>



            </ngx-gridster-item>
        </ng-container>

        <!-- Mid  Size -->
        <ng-container *ngIf="toMedium">
            <ngx-gridster-item *ngFor="let panel of panels" [options]="itemOptions" [dragAndDrop]="panel.dragAndDrop"
                [resizable]="panel.resizable" [(w)]="panel.tamanyMig.w" [(h)]="panel.tamanyMig.h"
                [(x)]="panel.tamanyMig.x" [(y)]="panel.tamanyMig.y" (change)="itemChange($event, panel)">

                <ng-container [ngSwitch]="panel.type">

                    <eda-blank-panel *ngSwitchCase="0" #edaPanel [panel]="panel" [inject]="inject"
                        (remove)="onRemovePanel($event)">
                    </eda-blank-panel>

                    <eda-title-panel *ngSwitchCase="1" #edaPanel [panel]="panel" [inject]="inject"
                        (remove)="onRemovePanel($event)">
                    </eda-title-panel>

                </ng-container>

            </ngx-gridster-item>
        </ng-container>

        <!-- Mobile Size -->
        <ng-container *ngIf="toLitle">
            <ngx-gridster-item *ngFor="let panel of panels" [options]="itemOptions" [dragAndDrop]="panel.dragAndDrop"
                [resizable]="panel.resizable" [(w)]="panel.tamanyMobil.w" [(h)]="panel.tamanyMobil.h"
                [(x)]="panel.tamanyMobil.x" [(y)]="panel.tamanyMobil.y" (change)="itemChange($event, panel)">

                <ng-container [ngSwitch]="panel.type">

                    <eda-blank-panel *ngSwitchCase="0" #edaPanel [panel]="panel" [inject]="inject"
                        (remove)="onRemovePanel($event)">
                    </eda-blank-panel>

                    <eda-title-panel *ngSwitchCase="1" #edaPanel [panel]="panel" [inject]="inject"
                        (remove)="onRemovePanel($event)">
                    </eda-title-panel>

                </ng-container>

            </ngx-gridster-item>
        </ng-container>



    </ngx-gridster>

</div>

<!-- ============================================================== -->
<!-- GLOBAL FILTERS PANEL -->
<!-- ============================================================== -->
<dashboard-filter-dialog *ngIf="filterController" [controller]="filterController"></dashboard-filter-dialog>

<!-- ============================================================== -->
<!-- Right sidebar -->
<!-- ============================================================== -->
<p-sidebar [(visible)]="display_v.rightSidebar" position="right" [baseZIndex]="10000">
    <div class="right-sidebar-blocks-options block-options-bg pointer mt-1" (click)="onAddWidget()">
        <div>
            <i class="fa fa-columns"></i>
            <span i18n="@@opcionPanel" class="ml-2">NUEVO PANEL</span>
        </div>
    </div>

    <div class="right-sidebar-blocks-options block-options-bg pointer mt-1" (click)="onAddTitle()">
        <div>
            <i class="fa fa-columns"></i>
            <span i18n="@@opcionTitulo" class="ml-2">NUEVO TEXTO</span>
        </div>
    </div>

    <div class="right-sidebar-blocks-options block-options-bg pointer mt-1" (click)="addGlobalFilter()">
        <div>
            <i class="fa fa-filter"></i>
            <span i18n="@@opcionFiltro" class="ml-2">NUEVO FILTRO</span>
        </div>
    </div>

    <hr>

    <div class="right-sidebar-blocks-options block-options-bg pointer mt-1" (click)="onResetWidgets()">
        <div>
            <i class="fa fa-ban"></i>
            <span i18n="@@opcionInforme" class="ml-2">RECARGAR INFORME</span>
        </div>
    </div>

    <div class="right-sidebar-blocks-options block-options-bg pointer mt-1" (click)="saveDashboard()">
        <div>
            <i class="fa fa-save"></i>
            <span i18n="@@opcionGuardar" class="ml-2">GUARDAR INFORME</span>
        </div>
    </div>
    <hr>
    <div class="right-sidebar-blocks-options block-options-bg pointer mt-1" (click)="exportAsPDF();">
        <div>
            <i class="fa fa-download"></i>
            <span i18n="@@opcionPdf" class="ml-2">DESCARGAR PDF</span>
        </div>
    </div>

    <div class="right-sidebar-blocks-options block-options-bg pointer mt-1" (click)="exportAsJPEG();">
        <div>
            <i class="fa fa-download"></i>
            <span i18n="@@opcionImagen" class="ml-2">DESCARGAR IMAGEN</span>
        </div>
    </div>

    <hr>

    <div>
        <form [formGroup]="form">
            <div style="margin: 8px; display: flex;">
                <p-selectButton [options]="visibleTypes" formControlName="visible"
                    (onChange)="handleSelectedBtn($event)">
                </p-selectButton>
                <div class="w-100" *ngIf="display_v.groups">
                    <p-multiSelect id="float-grups" formControlName="group" [options]="grups" [filter]="false"
                        optionLabel="name" defaultLabel="Elige grupos *" [style]="{ width: '100%' }" itemSize="30"
                        (onPanelHide)="saveDashboard()">
                    </p-multiSelect>
                </div>

            </div>
        </form>
        <button id="copy-link" (click)="copyURL()" *ngIf="display_v.shared">
            <span>
                <i class="fa fa-files-o" aria-hidden="true"></i>
                copiar URL p√∫blica
            </span>
        </button>
    </div>
</p-sidebar>

<div *ngIf="display_v.edit_mode">
    <span i18n="@@notSavedChanges" class="div-cambios " *ngIf="display_v.notSaved"> Hay cambios sin guardar... </span>

    <button (click)="display_v.rightSidebar = true"
        class="right-side-toggle waves-effect waves-light btn-inverse btn btn-circle btn-sm pull-right m-l-10">
        <i class="fa fa-cog text-white"></i>
    </button>
</div>