<eda-dialog [inject]="dialog">
  <div body>
    <ng-container *ngIf="params?.isnew">
      <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
    </ng-container>
    <ng-container *ngIf="!params?.isnew">
      <ng-container *ngTemplateOutlet="filtersTemplate"></ng-container>
    </ng-container>
  </div>

    <div body>
        <ng-container *ngIf="params?.isnew">
            <ng-container *ngTemplateOutlet="filterTemplate;"></ng-container>
        </ng-container>
        <ng-container *ngIf="!params?.isnew">
            <ng-container *ngTemplateOutlet="filtersTemplate;"></ng-container>
        </ng-container>
    </div>

    <div footer>
        <div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix text-right">
            <button id="saveFilterButton" type="submit" pButton (click)="saveGlobalFilter()" i18n-label="@@guardarBtn"
                label="Confirmar" icon="fa fa-check" class="p-button-raised p-button-success" [disabled]="confirmDisabled()"></button>
            <button type="button" pButton (click)="closeDialog()" class="p-button-raised p-button-danger"
                i18n-label="@@cancelarBtn" label="Cancelar"></button>
        </div>
    </div>
  </div>
</eda-dialog>

<ng-template #filterTemplate>
  <!-- <p-card [header]="header1">
    <div class="grid">
      <div class="col-12">
        <p-inputSwitch
          id="applyToAllFiltersButton"
          (onChange)="applyToAllCheck()"
          [(ngModel)]="switchChecked"
        >
        </p-inputSwitch>
      </div>
    </div>
  </p-card> -->
  <p-card [header]="header3" id="anywhereClick">
    <div class="grid">
      <div class="col-12">
        <br />
        <div class="grid">
            <div class="col-12">
                <div class="grid">
                    <div class="col-4">
                        <div class="filterDialogTitles">{{header1}}</div>
                        <p-inputSwitch id="applyToAllFiltersButton" (onChange)="applyToAllCheck()" [(ngModel)]="switchChecked"></p-inputSwitch>
                    </div>
                    <div class="col-4">
                    </div>
                    <div class="col-4">
                        <div  i18n-title="@@filterVisibleScope" title="Definir la visibilidad del filtro. Público: todos pueden usarlo.  Deshabilitado: El resto de usuarios pueden ver el filtro pero no pueden modificarlo.  Oculto: El resto de usuario no pueden ver el filtro. Pero se les aplica" class="filterDialogTitles">{{header4}}</div>
                        <p-dropdown id="applyToOneFilterDropdown"
                        i18n-title="@@filterVisibleScope" title="Definir la visibilidad del filtro. Público: todos pueden usarlo.  Deshabilitado: El resto de usuarios pueden ver el filtro pero no pueden modificarlo.  Oculto: El resto de usuarios no pueden ver el filtro, pero se les aplica"
                        [options]="publicRoHidden" [(ngModel)]="publicRoHiddenOption" selected="publicRoHiddenOption" autoWidth="false"></p-dropdown>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
  </p-card>


  <div style="margin: 1rem"></div>

  <p-card *ngIf="switchChecked" [header]="header2">
    <div class="grid">
      <div class="col-12 ">
        <div class="table-responsive">
          <table class="table">
            <tr>

              <th>
                Panel
              </th>
              <th>Ruta del filtro</th>

            </tr>


        <tr
          *ngFor="let panel of panelsToDisplay">
        <td>
          <button  type="button" pButton class="btn btn-sm" style="margin-right: 0.5rem;"
                [ngClass]="{'ui-button-selected': panel.active, 'ui-button-unselected':!panel.active, 'ui-button-unvaliable':!panel.avaliable}"
                (click)="addPanelToFilter(panel)" label={{panel.title}}>

            </button>
        </td>
        <td>
          <div ng-reflect-ng-class="[object Object]" ng-reflect-ng-style="[object Object]" class="p-dropdown p-component" style="width: 100%;"><div class="p-hidden-accessible"><input type="text" readonly="" aria-haspopup="listbox" pautofocus="" role="combobox" class="p-element" placeholder="Ruta del filtro" aria-expanded="false"></div><!--bindings={
            "ng-reflect-ng-if": "false"
          }--><span ng-reflect-ng-class="[object Object]" class="p-dropdown-label p-inputtext p-placeholder ng-star-inserted">Ruta del filtro</span><!--bindings={
            "ng-reflect-ng-if": "true"
          }--><!--bindings={}--><!--bindings={
            "ng-reflect-ng-if": "false"
          }--><div role="button" aria-label="dropdown trigger" aria-haspopup="listbox" class="p-dropdown-trigger"><span class="p-dropdown-trigger-icon pi pi-chevron-down" ng-reflect-ng-class="pi pi-chevron-down"></span></div><p-overlay class="p-element ng-tns-c73-38 ng-star-inserted" ng-reflect-target="@parent" ng-reflect-append-to="body"><!--bindings={
            "ng-reflect-ng-if": "false"
          }--></p-overlay></div>
        </td>
        </tr>






      </table>
    </div>

        <div style="margin-top: 1rem">
          <span style="margin: 0.5rem" class="dotgreen"></span>
          <span style="margin-right: 2rem">{{ greendot }}</span>

          <span style="margin: 0.5rem" class="dotred"></span>
          <span style="margin-right: 2rem">{{ reddot }}</span>

          <span style="margin: 0.5rem" class="dotunselected"></span>
          <span style="margin-right: 2rem">{{ unselecteddot }}</span>
        </div>
      </div>
    </div>
  </p-card>

  <div style="margin: 1rem"></div>

</ng-template>

<ng-template #filtersTemplate>


    <ng-container *ngIf="selectedFilter && !selectedFilter?.isdeleted">
        <p-card [header]="selectedFilter.table?.label + ' -' + selectedFilter.column?.label">
            <ng-container *ngTemplateOutlet="filterTemplate;"></ng-container>
        </p-card>
    </ng-container>
    <div class="col-12 pl-2">
        <p-card  [header]="posicion" >
            <div cdkDropList cdkDropListOrientation="horizontal" class="select-list" [cdkDropListData]="filtersList" (cdkDropListDropped)="onReorderFilter($event)">
                <ng-container *ngFor="let filter of filtersList">
                    <div *ngIf="!filter.isdeleted" class="select-box col-3 col-md-2 p-1" cdkDrag>
                        <span class="close-thin pointer" (click)="removeFilter(filter, 'select')"></span>

                        <span class="text-center" [ngClass]="(selectedFilter.table==filter.table) && (selectedFilter.column.label==filter.column.label)?'edaEmfasis':''">
                            {{filter.column.label}}
                        </span>
                    </div>
                </ng-container>
            </div>
        </p-card>
    </div>
</ng-template>
